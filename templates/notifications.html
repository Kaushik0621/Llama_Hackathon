<!-- Notifications Component -->
<div id="notifications-container" class="notifications">
    {% if initial_notifications %}
        {% for notification in initial_notifications %}
        <div class="notification {% if notification.type == 'red' %}high-priority
                               {% elif notification.type == 'yellow' %}medium-priority
                               {% else %}low-priority{% endif %}">
            {{ notification.message }}
        </div>
        {% endfor %}
    {% endif %}
</div>

<style>
    /* Notifications Container */
    .notifications {
        position: fixed;
        top: 100px;
        right: 30px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 350px;
    }

    /* Individual Notification */
    .notification {
        background: white;
        border-radius: 12px;
        padding: 16px 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
        font-size: 14px;
        font-weight: 500;
        opacity: 1;
        transform: translateX(0);
        transition: all 0.3s ease;
        border-left: 4px solid;
        display: flex;
        align-items: center;
        backdrop-filter: blur(10px);
    }

    .notification.high-priority {
        border-left-color: #ff6b6b;
        background: linear-gradient(to right, #fff, #fff);
        color: #d63031;
    }

    .notification.medium-priority {
        border-left-color: #ffd93d;
        background: linear-gradient(to right, #fff, #fff);
        color: #b7791f;
    }

    .notification.low-priority {
        border-left-color: #51cf66;
        background: linear-gradient(to right, #fff, #fff);
        color: #2f9e44;
    }

    /* Animation for new notifications */
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .notification {
        animation: slideIn 0.3s ease forwards;
    }
</style>

<script>
    let lastCheck = 0;  // Track last check time
    let checkTimeout = null;  // For debouncing

    function createNotificationElement(notification) {
        const div = document.createElement('div');
        div.className = `notification ${
            notification.type === 'red' ? 'high-priority' :
            notification.type === 'yellow' ? 'medium-priority' :
            'low-priority'
        }`;
        
        // Add priority icon
        const icon = document.createElement('span');
        icon.className = 'priority-indicator';
        icon.style.marginRight = '12px';
        icon.classList.add(
            notification.type === 'red' ? 'priority-red' :
            notification.type === 'yellow' ? 'priority-yellow' :
            'priority-green'
        );
        
        div.appendChild(icon);
        div.appendChild(document.createTextNode(notification.message));
        return div;
    }

    // Add debounced check function
    function debouncedCheck() {
        if (checkTimeout) clearTimeout(checkTimeout);
        checkTimeout = setTimeout(checkNotifications, 300);  // 300ms delay
    }

    // Modify the existing checkNotifications function to prevent duplicate checks
    async function checkNotifications() {
        const now = Date.now();
        // Prevent checking more often than every 2 seconds
        if (now - lastCheck < 2000) return;
        
        try {
            lastCheck = now;
            const response = await fetch('/admin/check-notifications');
            const notifications = await response.json();
            
            const container = document.getElementById('notifications-container');
            
            notifications.forEach(notification => {
                const notificationElement = createNotificationElement(notification);
                container.appendChild(notificationElement);
                
                // Remove notification after 5 seconds
                setTimeout(() => {
                    notificationElement.style.opacity = '0';
                    setTimeout(() => {
                        if (notificationElement.parentNode === container) {
                            container.removeChild(notificationElement);
                        }
                    }, 500);
                }, 5000);
            });
        } catch (error) {
            console.error('Error checking notifications:', error);
        }
    }

    // Add event listener for custom event
    document.addEventListener('checkNotifications', debouncedCheck);

    // Initialize notifications
    document.addEventListener('DOMContentLoaded', () => {
        // Check immediately on load
        checkNotifications();
        
        // Then check every 30 seconds
        setInterval(checkNotifications, 30000);
    });
</script> 